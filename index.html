<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Bit√°cora de Rutas GPS</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.css" />

    <style>
        :root { --primary: #2c3e50; --accent: #1abc9c; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        #sidebar { width: 300px; background: var(--primary); color: white; display: flex; flex-direction: column; }
        .header { padding: 20px; background: #1a252f; text-align: center; }
        #lista-rutas { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .ruta-card { 
            background: #34495e; padding: 12px; margin-bottom: 8px; border-radius: 6px; 
            cursor: pointer; transition: 0.3s; border-left: 5px solid transparent;
        }
        .ruta-card:hover { background: #456789; }

        /* Mapa y Dashboard */
        #main { flex-grow: 1; position: relative; display: flex; flex-direction: column; }
        #map { flex-grow: 1; }
        #stats-panel { 
            position: absolute; top: 15px; right: 15px; z-index: 1000;
            background: rgba(255,255,255,0.9); padding: 15px; border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); min-width: 180px;
        }
        .stat-val { font-weight: bold; color: var(--primary); font-size: 1.2em; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="header">
        <h2 style="margin:0">üöµ Mis Rutas</h2>
    </div>
    <div id="lista-rutas">
        </div>
</div>

<div id="main">
    <div id="stats-panel">
        <div style="margin-bottom:8px">üìè <b>Distancia:</b> <span id="total-dist" class="stat-val">0</span> km</div>
        <div style="margin-bottom:8px">‚õ∞Ô∏è <b>Desnivel:</b> <span id="total-elev" class="stat-val">0</span> m</div>
        <div>üìç <b>Total:</b> <span id="count" class="stat-val">0</span> tracks</div>
    </div>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-gpx/gpx.js"></script>
<script src="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.js"></script>

<script>
    // 1. CONFIGURACI√ìN INICIAL
    const map = L.map('map').setView([40.41, -3.70], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    let totalKM = 0, totalElev = 0, count = 0;
    const gpxGroup = L.featureGroup().addTo(map);

    // 2. TUS DATOS (A√±ade aqu√≠ tus rutas)
    const misRutas = [
        { nombre: "Vuelta al Embalse", archivo: "rutas/ruta1.gpx", tipo: "bici" },
        { nombre: "Subida al Pico", archivo: "rutas/ruta2.gpx", tipo: "senderismo" },
        { nombre: "Paseo Mar√≠timo", archivo: "rutas/ruta3.gpx", tipo: "running" }
    ];

    function getColor(tipo) {
        const colores = { bici: '#3498db', senderismo: '#27ae60', running: '#e67e22' };
        return colores[tipo] || '#95a5a6';
    }

    // 3. PROCESAMIENTO
    misRutas.forEach((ruta, index) => {
        // Crear tarjeta en sidebar
        const card = document.createElement('div');
        card.className = 'ruta-card';
        card.style.borderLeftColor = getColor(ruta.tipo);
        card.innerHTML = `<strong>${ruta.nombre}</strong><br><small>${ruta.tipo.toUpperCase()}</small>`;
        document.getElementById('lista-rutas').appendChild(card);

        // Cargar GPX en el mapa
        const track = new L.GPX(ruta.archivo, {
            async: true,
            polyline_options: { color: getColor(ruta.tipo), weight: 3, opacity: 0.7 },
            marker_options: { startIconUrl: null, endIconUrl: null }
        }).on('loaded', function(e) {
            const g = e.target;
            totalKM += (g.get_distance() / 1000);
            totalElev += g.get_elevation_gain();
            count++;

            // Actualizar Dashboard
            document.getElementById('total-dist').innerText = totalKM.toFixed(1);
            document.getElementById('total-elev').innerText = totalElev.toFixed(0);
            document.getElementById('count').innerText = count;

            // Zoom autom√°tico al cargar todas
            if(count === misRutas.length) map.fitBounds(gpxGroup.getBounds());
        }).addTo(gpxGroup);

        // Evento al hacer clic en la tarjeta
        card.onclick = () => {
            map.fitBounds(track.getBounds(), { padding: [50, 50] });
            track.bindPopup(`<b>${ruta.nombre}</b>`).openPopup();
        };
    });
</script>
</body>
</html>