---
import { planetData } from '../../data/planets';

export function getStaticPaths() {
	return planetData.map((planet) => ({
		params: { slug: planet.slug },
		props: { planet },
	}));
}

const { planet } = Astro.props;
---

<html lang="es">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{planet.name} | MINIPLANETAS - SQLP</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,500;9..144,700&family=Space+Grotesk:wght@400;500;600&display=swap"
		/>
	</head>
	<body>
		<header class="top">
			<a class="brand" href="/">MINIPLANETAS</a>
			<nav class="top-nav">
				<a href="/#explorar">Explorar</a>
				<a href="/#manifiesto">Manifiesto</a>
			</nav>
		</header>

		<main class="planet">
			<div class="planet-visual">
				<button class="planet-link" type="button" data-open-modal>
					<img src={planet.image} alt={`Mini planeta ${planet.name}`} loading="eager" />
				</button>
				<span class="planet-hint">Abrir imagen completa</span>
				<dialog class="planet-modal" aria-label={`Imagen completa de ${planet.name}`}>
					<button class="modal-close" type="button" data-close-modal>Close</button>
					<div class="modal-zoom">
						<img
							src={planet.image}
							alt={`Imagen completa de ${planet.name}`}
							loading="lazy"
							data-zoom-image
							draggable="false"
						/>
					</div>
					<p class="modal-hint">Click en la imagen para hacer zoom</p>
				</dialog>
				<div class="halo"></div>
			</div>
			<div class="planet-info">
				<p class="eyebrow">Mini planeta</p>
				<h1>{planet.name}</h1>
				<p class="lead">{planet.description}</p>
				<div class="meta">
					<div>
						<span>Tono</span>
						<strong>{planet.tone}</strong>
					</div>
					<div>
						<span>Órbita</span>
						<strong>{planet.orbit}</strong>
					</div>
					<div>
						<span>Escala</span>
						<strong>{planet.size}</strong>
					</div>
				</div>
				<a class="action" href="/#explorar">Volver a la cartografía</a>
			</div>
		</main>
		<script>
			const openButton = document.querySelector<HTMLButtonElement>('[data-open-modal]');
			const closeButton = document.querySelector<HTMLButtonElement>('[data-close-modal]');
			const dialog = document.querySelector<HTMLDialogElement>('.planet-modal');
			const zoomImage = document.querySelector<HTMLImageElement>('[data-zoom-image]');
			const closeWithAnimation = () => {
				if (!dialog || !dialog.open) {
					return;
				}
				dialog.classList.add('is-closing');
				window.setTimeout(() => {
					dialog.close();
					dialog.classList.remove('is-closing');
				}, 180);
			};

			if (openButton && closeButton && dialog) {
				openButton.addEventListener('click', () => {
					dialog.classList.remove('is-closing');
					dialog.classList.remove('is-zoomed');
					dialog.showModal();
				});
				closeButton.addEventListener('click', closeWithAnimation);
				dialog.addEventListener('click', (event) => {
					if (event.target === dialog) {
						closeWithAnimation();
					}
				});
				dialog.addEventListener('cancel', (event) => {
					event.preventDefault();
					closeWithAnimation();
				});
			}

			if (zoomImage && dialog) {
				zoomImage.addEventListener('click', () => {
					if (zoomImage.dataset.dragged === 'true') {
						zoomImage.dataset.dragged = 'false';
						return;
					}
					dialog.classList.toggle('is-zoomed');
				});
			}

			const setupDragPan = () => {
				if (!dialog || !zoomImage) {
					return;
				}
				const container = document.querySelector<HTMLDivElement>('.modal-zoom');
				if (!container) {
					return;
				}
				let isDragging = false;
				let startX: number | null = null;
				let startY: number | null = null;
				const dragThreshold = 6;

				const onMouseDown = (event: MouseEvent) => {
					if (!dialog.classList.contains('is-zoomed')) {
						return;
					}
					if (event.button !== 0) {
						return;
					}
					isDragging = false;
					startX = event.clientX;
					startY = event.clientY;
					event.preventDefault();
				};

				const onMouseMove = (event: MouseEvent) => {
					if (startX === null || startY === null) {
						return;
					}
					const dx = event.clientX - startX;
					const dy = event.clientY - startY;
					if (!isDragging) {
						if (Math.hypot(dx, dy) < dragThreshold) {
							return;
						}
						isDragging = true;
						container.classList.add('is-dragging');
						zoomImage.dataset.dragged = 'true';
					}
					event.preventDefault();
					container.scrollLeft -= dx;
					container.scrollTop -= dy;
					startX = event.clientX;
					startY = event.clientY;
				};

				const onMouseUp = () => {
					if (startX === null) {
						return;
					}
					isDragging = false;
					startX = null;
					startY = null;
					container.classList.remove('is-dragging');
				};

				container.addEventListener('mousedown', onMouseDown);
				window.addEventListener('mousemove', onMouseMove);
				window.addEventListener('mouseup', onMouseUp);
			};

			setupDragPan();
		</script>
	</body>
</html>

<style>
	:global(:root) {
		--bg-1: #07040f;
		--bg-2: #0e162e;
		--bg-3: #1a0936;
		--text: #f7f2ff;
		--muted: rgba(247, 242, 255, 0.72);
		--accent: #ffb74d;
		--accent-2: #4dd0e1;
		--stroke: rgba(255, 255, 255, 0.12);
		--card: rgba(18, 12, 32, 0.78);
	}

	:global(*) {
		box-sizing: border-box;
	}

	:global(body) {
		margin: 0;
		font-family: 'Space Grotesk', sans-serif;
		color: var(--text);
		background:
			radial-gradient(circle at 85% 10%, rgba(255, 183, 77, 0.28), transparent 40%),
			radial-gradient(circle at 10% 40%, rgba(77, 208, 225, 0.25), transparent 45%),
			linear-gradient(150deg, var(--bg-2), var(--bg-1) 60%, var(--bg-3));
		min-height: 100vh;
	}

	:global(a) {
		color: inherit;
		text-decoration: none;
	}

	.top {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 1.5rem 6vw;
		position: sticky;
		top: 0;
		z-index: 10;
		background: linear-gradient(180deg, rgba(7, 4, 15, 0.92), rgba(7, 4, 15, 0.4));
		backdrop-filter: blur(14px);
		border-bottom: 1px solid rgba(255, 255, 255, 0.08);
	}

	.brand {
		font-family: 'Fraunces', serif;
		letter-spacing: 0.22em;
		font-size: 0.9rem;
		text-transform: uppercase;
	}

	.top-nav {
		display: flex;
		align-items: center;
		gap: 1.5rem;
		font-size: 0.95rem;
	}

	.planet {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
		gap: 3rem;
		align-items: center;
		padding: 2.5rem 6vw 4rem;
	}

	.planet-visual {
		position: relative;
		display: grid;
		place-items: center;
		gap: 0.75rem;
	}

	.planet-link {
		display: inline-flex;
		border-radius: 50%;
		background: transparent;
		border: none;
		padding: 0;
	}

	.planet-visual img {
		width: min(360px, 70vw);
		height: auto;
		filter: drop-shadow(0 30px 50px rgba(6, 6, 20, 0.7));
		animation: float 6s ease-in-out infinite;
		border-radius: 50%;
		cursor: zoom-in;
	}

	.planet-modal {
		border: none;
		padding: 1.5rem;
		border-radius: 18px;
		background: rgba(8, 8, 14, 0.92);
		color: var(--text);
		width: calc(100vw - 100px);
		height: calc(100vh - 100px);
		max-width: calc(100vw - 100px);
		max-height: calc(100vh - 100px);
		box-shadow: 0 30px 70px rgba(5, 7, 16, 0.6);
	}

	.planet-modal[open] {
		animation: modal-in 0.22s ease;
	}

	.planet-modal.is-closing {
		animation: modal-out 0.18s ease forwards;
	}

	.planet-modal::backdrop {
		background: rgba(4, 6, 16, 0.72);
		backdrop-filter: blur(6px);
	}

	.planet-modal[open]::backdrop {
		animation: backdrop-in 0.22s ease;
	}

	.planet-modal.is-closing::backdrop {
		animation: backdrop-out 0.18s ease forwards;
	}

	.planet-modal img {
		width: 100%;
		height: auto;
		display: block;
		border-radius: 14px;
		animation: none;
		cursor: zoom-in;
		transition: width 0.2s ease;
	}

	.modal-zoom {
		max-height: 75vh;
		overflow: auto;
		border-radius: 14px;
		display: block;
	}

	.planet-modal.is-zoomed .modal-zoom {
		cursor: grab;
		touch-action: none;
	}

	.planet-modal.is-zoomed .modal-zoom img {
		cursor: grab;
	}

	.planet-modal.is-zoomed .modal-zoom.is-dragging {
		cursor: grabbing;
	}

	.planet-modal.is-zoomed .modal-zoom.is-dragging img {
		cursor: grabbing;
	}

	.planet-modal.is-zoomed img {
		user-select: none;
	}

	.planet-modal.is-zoomed .modal-zoom {
		overflow: auto;
	}

	.planet-modal.is-zoomed img {
		width: 160%;
		max-width: none;
		cursor: zoom-out;
	}

	.modal-hint {
		margin: 0.75rem 0 0;
		font-size: 0.8rem;
		text-transform: uppercase;
		letter-spacing: 0.14em;
		color: rgba(247, 242, 255, 0.55);
	}

	.modal-close {
		margin-left: auto;
		margin-bottom: 0.75rem;
		padding: 0.4rem 0.8rem;
		border-radius: 999px;
		border: 1px solid var(--stroke);
		background: transparent;
		color: var(--text);
		font-size: 0.85rem;
		text-transform: uppercase;
		letter-spacing: 0.12em;
		cursor: pointer;
	}

	@keyframes modal-in {
		from {
			opacity: 0;
			transform: translateY(10px) scale(0.98);
		}
		to {
			opacity: 1;
			transform: translateY(0) scale(1);
		}
	}

	@keyframes modal-out {
		from {
			opacity: 1;
			transform: translateY(0) scale(1);
		}
		to {
			opacity: 0;
			transform: translateY(8px) scale(0.98);
		}
	}

	@keyframes backdrop-in {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}

	@keyframes backdrop-out {
		from {
			opacity: 1;
		}
		to {
			opacity: 0;
		}
	}

	.planet-hint {
		font-size: 0.85rem;
		color: rgba(247, 242, 255, 0.6);
		letter-spacing: 0.08em;
		text-transform: uppercase;
	}

	.halo {
		position: absolute;
		width: min(420px, 80vw);
		height: min(420px, 80vw);
		border-radius: 50%;
		background: radial-gradient(circle, rgba(255, 255, 255, 0.08), transparent 70%);
		z-index: -1;
	}

	.planet-info {
		display: grid;
		gap: 1.5rem;
		max-width: 520px;
	}

	.eyebrow {
		text-transform: uppercase;
		letter-spacing: 0.34em;
		font-size: 0.7rem;
		color: var(--accent);
		margin: 0;
	}

	.planet-info h1 {
		font-family: 'Fraunces', serif;
		font-size: clamp(2.2rem, 4vw, 3.4rem);
		margin: 0;
	}

	.lead {
		color: var(--muted);
		font-size: 1.05rem;
		margin: 0;
	}

	.meta {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
		gap: 1rem;
	}

	.meta div {
		background: var(--card);
		border: 1px solid var(--stroke);
		border-radius: 16px;
		padding: 1rem;
		display: grid;
		gap: 0.35rem;
	}

	.meta span {
		font-size: 0.8rem;
		text-transform: uppercase;
		letter-spacing: 0.18em;
		color: rgba(247, 242, 255, 0.6);
	}

	.meta strong {
		font-size: 1rem;
	}

	.action {
		padding: 0.75rem 1.6rem;
		border-radius: 999px;
		background: linear-gradient(120deg, var(--accent), var(--accent-2));
		color: #1b0d2b;
		font-weight: 600;
		box-shadow: 0 18px 30px rgba(77, 208, 225, 0.18);
		width: fit-content;
	}

	@keyframes float {
		0%,
		100% {
			transform: translateY(0);
		}
		50% {
			transform: translateY(-12px);
		}
	}
</style>
